{
  "version": "0.0.1",
  "portalUrls": [],
  "resourcePrefix": "sites/amazon/sql/extract/crawl",
  "jdbcSink": {
    "driver": "com.mysql.cj.jdbc.Driver",
    "url": "jdbc:mysql://47.103.79.201:3306/mallbigdata_us",
    "username": "mytest",
    "password": "123456@"
  },
  "apiSink":{
    "url": "https://localhost:8082/api/model",
    "authToken": "some_auth_token"
  },
  "syncConfig": {
    "batchSize": 40,
    "cacheTTL": "10m"
  },
  "extractRules": [
    {
      "id": 1,
      "urlPattern": ".+/dp/.+",
      "minContentSize": 500000,
      "minNumNonBlankFields": 20,
      "sqlTemplate": "x-asin.sql",
      "collection": "asin_sync_utf8mb4",
      "sql": "select\n    dom_base_uri(dom) as url,\n    str_substring_between(dom_first_href(dom, 'span.zg-item a'), '/dp/', '/ref=') as `asin`,\n    str_substring_between(dom_base_uri(dom), '.com/', '/ref=') as `category`,\n    dom_first_integer(dom, 'span.zg-badge-text', 0) as `rank`,\n    dom_first_text(dom, 'div > a > span.a-color-price') as `price`,\n    dom_first_text(dom, 'span.zg-item a > div:expr(img=0 && char>30)') as title,\n    dom_first_attr(dom, 'span.zg-item div img[src]', 'src') as `pic`,\n    str_substring_between(dom_first_attr(dom, 'span.zg-item div a i.a-icon-star', 'class'), ' a-star-', ' ') as score,\n    dom_first_text(dom, 'span.zg-item div a:has(i.a-icon-star) ~ a') as starnum\nfrom load_and_select('{{url}}', 'ol#zg-ordered-list > li.zg-item-immersion');"
    },
    {
      "id": 2,
      "urlPattern": ".+/seller/.+",
      "minContentSize": 100000,
      "minNumNonBlankFields": 8,
      "sqlTemplate": "x-sellers.sql",
      "collection": "seller_sync"
    },
    {
      "id": 3,
      "urlPattern": ".+/product-reviews/.+",
      "minContentSize": 100000,
      "minNumNonBlankFields": 10,
      "sqlTemplate": "x-product-reviews.sql",
      "collection": "asin_review_sync"
    },
    {
      "id": 4,
      "urlPattern": ".+/zgbs/.+",
      "minContentSize": 100000,
      "minNumNonBlankFields": 5,
      "sqlTemplate": "x-asin-best-sellers.sql",
      "collection": "asin_best_sellers_sync"
    },
    {
      "id": 5,
      "urlPattern": ".+/new-releases/.+",
      "minContentSize": 100000,
      "minNumNonBlankFields": 5,
      "sqlTemplate": "x-asin-new-releases.sql",
      "collection": "asin_new_releases_sync"
    },
    {
      "id": 6,
      "urlPattern": ".+/movers-and-shakers/.+",
      "minContentSize": 100000,
      "minNumNonBlankFields": 5,
      "sqlTemplate": "x-asin-movers-and-shakers.sql",
      "collection": "asin_movers_and_shakers_sync"
    },
    {
      "id": 7,
      "urlPattern": ".+/most-wished-for/.+",
      "minContentSize": 100000,
      "minNumNonBlankFields": 5,
      "sqlTemplate": "x-asin-most-wished-for.sql",
      "collection": "asin_most_wished_for_sync"
    },
    {
      "id": 100,
      "urlPattern": ".+/dp/.+",
      "minContentSize": 100000,
      "minNumNonBlankFields": 8,
      "sqlTemplate": "x-asin-ad-also-view.sql",
      "collection": "asin_ad_sync",
      "parentId": 1
    },
    {
      "id": 101,
      "urlPattern": ".+/dp/.+",
      "minContentSize": 100000,
      "minNumNonBlankFields": 8,
      "sqlTemplate": "x-asin-ad-similar.sql",
      "collection": "asin_ad_sync",
      "parentId": 1
    },
    {
      "id": 102,
      "urlPattern": ".+/dp/.+",
      "minContentSize": 100000,
      "minNumNonBlankFields": 8,
      "sqlTemplate": "x-asin-ad-sponsored.sql",
      "collection": "asin_ad_sync",
      "parentId": 1
    }
  ]
}
